{% extends "base.html" %}
{% block content %}
<div class="container my-4">
  <div class="text-center mb-4">
    <span class="d-inline-block rounded-circle bg-primary bg-opacity-10 p-3">
      <i class="bi bi-person-badge" style="font-size:2.2rem; color:#0d6efd;"></i>
    </span>
    <h2 class="fw-bold mt-2" style="color:#0d3a6f;">
      {% if doc %}Doctor Details &amp; Slots{% elif slot %}Book Appointment{% else %}Book Appointment{% endif %}
    </h2>
    <div class="text-muted mb-2" style="font-size:1.1rem;">
      {% if doc %}
        View doctor details and available slots
      {% elif slot %}
        Confirm your appointment details below
      {% else %}
        Book your appointment with ease
      {% endif %}
    </div>
  </div>

  {# -------- Case 1: Doctor Detail with available slots -------- #}
  {% if doc %}
  <div class="mx-auto" style="max-width: 600px;">
    <div class="card h-100 border-0 shadow-sm doctor-card">
      <div class="card-body d-flex flex-column align-items-center">
        <span class="rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center mb-3" style="width:60px; height:60px;">
          <i class="bi bi-person-circle" style="font-size:2.5rem; color:#0d6efd;"></i>
        </span>
        <h4 class="card-title mb-1 fw-semibold" style="color:#0d3a6f;">
          {{ doc.name }}
        </h4>
        <div class="text-muted small mb-2">{{ doc.specialization }}</div>
        <div class="mb-1 small text-muted">
          <i class="bi bi-hospital"></i> {{ doc.clinic_name }}, {{ doc.clinic_city }}
        </div>
        <div class="mb-1 small text-muted">
          <i class="bi bi-geo-alt"></i> {{ doc.address }}
        </div>
        <div class="mb-1 small text-muted">
          <i class="bi bi-currency-rupee"></i> {{ doc.fees }}
        </div>
        {% if doc.about %}
        <div class="mb-2 small text-secondary" style="min-height:2.2em;">{{ doc.about }}</div>
        {% else %}
        <div class="mb-2 small text-secondary" style="min-height:2.2em;">&nbsp;</div>
        {% endif %}

        <h5 class="mt-3 mb-2 fw-semibold" style="color:#0d3a6f;">Available Slots</h5>
        {% if slots and slots|length > 0 %}
          <ul class="list-group w-100 mb-0">
            {% for s in slots %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span class="small"><i class="bi bi-clock"></i> {{ s.date }} {{ s.time }}</span>
              <span>
                {% if s.booked_count < s.capacity %}
                  <a href="{{ url_for('book', slot_id=s.id) }}" class="btn btn-outline-primary btn-sm">
                    Book
                  </a>
                {% else %}
                  <span class="badge bg-danger">Full</span>
                {% endif %}
              </span>
            </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="alert alert-secondary mt-3 w-100 text-center">
            <i class="bi bi-calendar-x"></i> No slots available.
          </div>
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}


  {# -------- Case 2: Booking a specific slot -------- #}
  {% if slot %}
  <div class="container my-4">
    <div class="text-center mb-4">
      <span class="d-inline-block rounded-circle bg-primary bg-opacity-10 p-3">
        <i class="bi bi-calendar-plus" style="font-size:2.2rem; color:#0d6efd;"></i>
      </span>
      <h2 class="fw-bold mt-2" style="color:#0d3a6f;">Book Appointment</h2>
      <div class="text-muted mb-2" style="font-size:1.1rem;">
        Secure your slot with <span class="fw-semibold">{{ slot.doctor_name }}</span>
      </div>
    </div>
    <div class="mx-auto" style="max-width: 500px;">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="mb-3">
            <div class="fw-semibold" style="color:#0d3a6f; font-size:1.1rem;">
              <i class="bi bi-person-circle"></i> {{ slot.doctor_name }}
            </div>
            <div class="text-muted small mb-1">
              <i class="bi bi-hospital"></i> {{ slot.clinic_name }}
            </div>
            <div class="text-muted small mb-1">
              <i class="bi bi-currency-rupee"></i> {{ slot.fees }}
            </div>
            <div class="text-muted small mb-1">
              <i class="bi bi-calendar-event"></i> {{ slot.date }} 
              &nbsp; <i class="bi bi-clock"></i> {{ slot.time }}
            </div>
          </div>
          <form method="POST" class="bg-white rounded p-2">
            <div class="mb-3">
              <label class="form-label mb-1 small text-muted">Patient Name</label>
              <input type="text" class="form-control" name="patient_name" required>
            </div>
            <div class="mb-3">
              <label class="form-label mb-1 small text-muted">Patient Phone</label>
              <input type="text" class="form-control" name="patient_phone" required>
            </div>
            <div class="mb-3">
              <label class="form-label mb-1 small text-muted">Symptoms</label>
              <textarea class="form-control" name="symptoms" rows="2"></textarea>
            </div>
            <div class="d-grid">
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-check-circle me-1"></i>Confirm Booking
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

</div>
{% endblock %}
