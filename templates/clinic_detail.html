{% extends 'base.html' %}
{% block content %}
<div class="container my-4">
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
      <h3 class="text-primary mb-1">{{ clinic.name }}</h3>
      <div class="mb-2 text-muted"><i class="bi bi-geo-alt"></i> {{ clinic.city }}, {{ clinic.address }}</div>
      {% if clinic.phone %}
      <div class="mb-2"><i class="bi bi-telephone"></i> {{ clinic.phone }}</div>
      {% endif %}
      <!-- ⭐ Average Rating -->
      <div class="small mt-1">
        <i class="bi bi-star-fill" style="color:#ffc107;"></i>
        {% if clinic.average_rating and clinic.average_rating > 0 %}
          {{ "%.1f"|format(clinic.average_rating) }} / 5
        {% else %}
          No ratings yet
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Reviews -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-light fw-semibold">
      <i class="bi bi-chat-left-text"></i> Patient Reviews
    </div>
    <div class="card-body">
      {% if reviews %}
        {% for r in reviews %}
        <div class="mb-3 pb-2 border-bottom">
          <div class="d-flex align-items-center mb-1">
            <i class="bi bi-person-circle me-2" style="font-size:1.5rem; color:#0d6efd;"></i>
            <strong>{{ r.patient_name }}</strong>
            <span class="ms-2 small text-muted">{{ r.created_at }}</span>
          </div>
          <div class="small mb-1">
            <i class="bi bi-star-fill" style="color:#ffc107;"></i> {{ r.rating }} / 5
          </div>
          {% if r.comment %}
          <p class="small mb-0">{{ r.comment }}</p>
          {% endif %}
        </div>
        {% endfor %}
      {% else %}
        <div class="text-muted">No reviews yet. Be the first to review this clinic.</div>
      {% endif %}
    </div>
  </div>

  <!-- Leave Review -->
  {% if session.patient_id %}
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-light fw-semibold">
      <i class="bi bi-pencil-square"></i> Leave a Review
    </div>
    <div class="card-body">
      <form method="post" action="{{ url_for('review') }}">
        <input type="hidden" name="clinic_id" value="{{ clinic.id }}">
        <div class="mb-3">
          <label class="form-label">Rating</label>
          <select name="rating" class="form-select" required>
            <option value="">Select rating</option>
            <option value="5">⭐⭐⭐⭐⭐ - Excellent</option>
            <option value="4">⭐⭐⭐⭐ - Good</option>
            <option value="3">⭐⭐⭐ - Average</option>
            <option value="2">⭐⭐ - Poor</option>
            <option value="1">⭐ - Terrible</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Comment (optional)</label>
          <textarea name="comment" class="form-control" rows="2"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Submit Review</button>
      </form>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
