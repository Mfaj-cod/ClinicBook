{% extends 'base.html' %}
{% block content %}

<div class="min-vh-100" style="background: linear-gradient(135deg, #0d3a6f 0%, #084298 100%); border-radius: 20px;">
  
  <div class="container py-5">
    
    <div class="row justify-content-center text-center mb-5">
      <div class="col-lg-10">
        <style>
          /* 1. The Expanding Ring Animation (Ripple) */
          @keyframes ripple-effect {
            0% {
              box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.3);
            }
            70% {
              box-shadow: 0 0 0 20px rgba(255, 255, 255, 0); /* Expands to 20px and fades out */
            }
            100% {
              box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
            }
          }

          /* 2. Gentle Floating Animation */
          @keyframes float-gentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
          }

          .glass-ring-icon {
            /* Glassy background */
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
            
            /* Animations */
            animation: ripple-effect 2s infinite, float-gentle 4s ease-in-out infinite;
          }
        </style>

        <div class="d-inline-flex align-items-center justify-content-center rounded-circle p-4 mb-4 glass-ring-icon" style="width: 100px; height: 100px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="white" class="bi bi-heart-pulse" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748ZM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15Z"/>
                <path fill-rule="evenodd" d="M9.979 5.356a.5.5 0 0 0-.968.04L7.92 10.49l-.97-3.652a.5.5 0 0 0-.968-.04L5.29 9.255l-.54-.527a.5.5 0 0 0-.7.7l1 1a.5.5 0 0 0 .739-.036l.736-.975 1.154 4.333a.5.5 0 0 0 .968-.04L9.58 7.51l.97 3.652a.5.5 0 0 0 .968.04l2-5a.5.5 0 0 0-.93-.36l-1.554 3.886-.954-4.372Z"/>
            </svg>
        </div>
        
        <h1 class="display-4 fw-bold text-white mb-3">Welcome to ClinicBook</h1>
        
        {% if session.doctor_id %}
        <p class="lead text-white-50 mb-4">
          Manage your appointments, slots, and patient bookings with ease.<br>
          Fast, easy, and secure.
        </p>
        <div class="d-flex justify-content-center gap-3">
          <a href="{{ url_for('doctors_dashboard') }}" class="btn btn-light btn-lg px-5 shadow-sm fw-bold text-primary">
            <i class="bi bi-speedometer2 me-2"></i> Dashboard
          </a>
        </div>
        {% else %}
        <p class="lead text-white-50 mb-4">
          Book appointments with doctors and clinics.<br>
          Fast, easy, and secure.
        </p>
        <div class="d-flex flex-column flex-sm-row justify-content-center gap-3 px-3">
          <a href="{{ url_for('doctors') }}" class="btn btn-light btn-lg px-5 shadow-sm fw-bold text-heading">
            <i class="bi bi-search me-2"></i> Find Doctors
          </a>
          {% if not session.patient_id %}
          <a href="{{ url_for('register') }}" class="btn btn-outline-light btn-lg px-5 fw-bold">
            <i class="bi bi-person-plus me-2"></i> Join Now
          </a>
          {% endif %}
        </div>
        {% endif %}
        
        <small class="text-white-50 d-block mt-4">Trusted by thousands of patients and clinics nationwide.</small>
      </div>
    </div>

    <div class="row g-4 mb-5">
      <div class="col-md-3 col-6">
        <div class="card border-0 shadow-lg h-100" style="backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.95);">
          <div class="card-body text-center p-4">
            <div class="text-primary mb-2"><i class="bi bi-people-fill fs-1"></i></div>
            <h3 class="counter fw-bold text-dark" data-target="50000">0</h3>
            <p class="text-muted mb-0">Happy Patients</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="card border-0 shadow-lg h-100" style="backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.95);">
          <div class="card-body text-center p-4">
            <div class="text-primary mb-2"><i class="bi bi-hospital fs-1"></i></div>
            <h3 class="counter fw-bold text-dark" data-target="1500">0</h3>
            <p class="text-muted mb-0">Verified Clinics</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="card border-0 shadow-lg h-100" style="backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.95);">
          <div class="card-body text-center p-4">
            <div class="text-primary mb-2"><i class="bi bi-calendar2-check fs-1"></i></div>
            <h3 class="counter fw-bold text-dark" data-target="100000">0</h3>
            <p class="text-muted mb-0">Appointments</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="card border-0 shadow-lg h-100" style="backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.95);">
          <div class="card-body text-center p-4">
            <div class="text-primary mb-2"><i class="bi bi-award fs-1"></i></div>
            <h3 class="counter fw-bold text-dark" data-target="50">0</h3>
            <p class="text-muted mb-0">Cities Served</p>
          </div>
        </div>
      </div>
    </div>

    <div class="card border-0 shadow-lg mb-5" style="backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.95);">
      <div class="card-header bg-transparent border-0 py-4 px-4">
        <h3 class="mb-0 fw-bold" style="color: #2c3e50;">
          <i class="bi bi-stars me-2 text-primary"></i>
          Why Choose ClinicBook?
        </h3>
        <p class="text-muted mb-0 mt-1">Experience healthcare booking reimagined</p>
      </div>
      <div class="card-body p-0 pb-4 overflow-hidden">
        <div class="features-carousel">
          <div class="carousel-track">
            {% for feature in features %}
            <div class="carousel-slide px-3">
              <div class="p-4 rounded-4 text-center h-100" style="background: #f8f9fa; border: 1px solid rgba(0,0,0,0.05);">
                <div class="d-inline-flex align-items-center justify-content-center rounded-circle p-3 mb-3 bg-{{ feature.color }} bg-opacity-10 text-{{ feature.color }}">
                  <i class="bi {{ feature.icon }} fs-3"></i>
                </div>
                <h5 class="fw-bold text-dark">{{ feature.title }}</h5>
                <p class="text-muted small mb-0">{{ feature.desc }}</p>
              </div>
            </div>
            {% endfor %}
            {% for feature in features %}
            <div class="carousel-slide px-3">
              <div class="p-4 rounded-4 text-center h-100" style="background: #f8f9fa; border: 1px solid rgba(0,0,0,0.05);">
                <div class="d-inline-flex align-items-center justify-content-center rounded-circle p-3 mb-3 bg-{{ feature.color }} bg-opacity-10 text-{{ feature.color }}">
                  <i class="bi {{ feature.icon }} fs-3"></i>
                </div>
                <h5 class="fw-bold text-dark">{{ feature.title }}</h5>
                <p class="text-muted small mb-0">{{ feature.desc }}</p>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <div class="card border-0 shadow-lg mb-5" style="backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.95);">
      <div class="card-header bg-transparent border-0 py-4 px-4 d-flex justify-content-between align-items-center">
        <div>
          <h3 class="mb-0 fw-bold" style="color: #2c3e50;">
            <i class="bi bi-building me-2 text-primary"></i>
            Popular Clinics
          </h3>
          <p class="text-muted mb-0 mt-1">Top-rated clinics trusted by patients</p>
        </div>
        <!-- <div class="slider-controls">
           <button class="btn btn-outline-primary btn-sm rounded-circle slider-prev"><i class="bi bi-chevron-left"></i></button>
           <button class="btn btn-outline-primary btn-sm rounded-circle slider-next"><i class="bi bi-chevron-right"></i></button>
        </div> -->
      </div>
      <div class="card-body p-4 position-relative">
        <div class="clinics-slider overflow-hidden">
          <div class="slider-container d-flex" style="transition: transform 0.3s ease-out;">
            {% for clinic in clinics %}
            <div class="slider-card px-2" style="min-width: 350px;">
              <div class="card h-100 border-0 shadow-sm hover-lift" style="background: #f8f9fa;">
                <div class="card-body p-4">
                  <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="rounded-circle bg-white p-3 shadow-sm text-primary">
                      <i class="bi bi-building fs-4"></i>
                    </div>
                    <span class="badge bg-success bg-opacity-10 text-success rounded-pill px-3">Top Rated</span>
                  </div>
                  
                  <h5 class="fw-bold text-dark mb-1">{{ clinic.name }}</h5>
                  <p class="text-muted small mb-3"><i class="bi bi-geo-alt me-1"></i> {{ clinic.city }}</p>
                  
                  {% if clinic.address %}
                  <p class="text-muted small mb-3 text-truncate"><i class="bi bi-geo me-1"></i> {{ clinic.address }}</p>
                  {% endif %}
                  
                  <div class="d-flex align-items-center mb-4">
                    <div class="text-warning me-2">
                      {% for i in range(5) %}
                      <i class="bi bi-star{% if clinic.average_rating and clinic.average_rating > i %}fill{% endif %}"></i>
                      {% endfor %}
                    </div>
                    <span class="fw-bold text-dark small">
                      {% if clinic.average_rating and clinic.average_rating > 0 %}
                        {{ "%.1f"|format(clinic.average_rating) }}
                      {% else %}
                        N/A
                      {% endif %}
                    </span>
                  </div>
                  
                  <a href="{{ url_for('clinic_detail', clinic_id=clinic.id) }}" class="btn btn-primary w-100" style="background: linear-gradient(135deg, #0d3a6f 0%, #084298 100%); border: none;">
                    View Details
                  </a>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    {% if not session.patient_id and not session.doctor_id %}
    <div class="card border-0 shadow-lg" style="backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.95);">
      <div class="card-body p-5 text-center">
        <div class="row align-items-center justify-content-center">
          <div class="col-lg-8">
            <h2 class="fw-bold mb-3" style="color: #2c3e50;">Ready to Get Started?</h2>
            <p class="text-muted lead mb-4">
              Join thousands of patients and doctors utilizing ClinicBook for seamless healthcare management.
            </p>
            <div class="d-flex justify-content-center gap-3 flex-wrap">
              <a href="{{ url_for('register_doctor') }}" class="btn btn-outline-primary btn-lg px-4">
                <i class="bi bi-briefcase-medical me-2"></i> Register as Doctor
              </a>
              <a href="{{ url_for('register') }}" class="btn btn-primary btn-lg px-4 text-white" style="background: linear-gradient(135deg, #0d3a6f 0%, #084298 100%); border: none;">
                <i class="bi bi-person-plus me-2"></i> Register as Patient
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

  </div>
</div>

<style>
.hover-lift {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.hover-lift:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
}

/* Feature Carousel Animation */
.features-carousel {
  overflow: hidden;
  white-space: nowrap;
  position: relative;
}
.carousel-track {
  display: inline-block;
  animation: scroll 30s linear infinite;
}
.carousel-slide {
  display: inline-block;
  width: 300px;
  white-space: normal; /* Allow text wrapping inside card */
}

@keyframes scroll {
  0% { transform: translateX(0); }
  100% { transform: translateX(calc(-300px * {{ features|length }})); }
}

/* Slider Overrides */
.slider-container {
  display: flex;
  transition: transform 0.5s ease-in-out;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // 1. Counter Animation
  const counters = document.querySelectorAll('.counter');
  const speed = 200;
  
  const updateCount = (counter) => {
    const target = +counter.getAttribute('data-target');
    const count = +counter.innerText;
    const increment = target / speed;
    
    if (count < target) {
      counter.innerText = Math.ceil(count + increment);
      setTimeout(() => updateCount(counter), 1);
    } else {
      counter.innerText = target;
    }
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        updateCount(entry.target);
        observer.unobserve(entry.target);
      }
    });
  });
  
  counters.forEach(counter => observer.observe(counter));

  // 2. Clinics Slider Logic
  const track = document.querySelector('.slider-container');
  const prevBtn = document.querySelector('.slider-prev');
  const nextBtn = document.querySelector('.slider-next');
  const cards = document.querySelectorAll('.slider-card');
  
  if (track && cards.length > 0) {
    let currentIndex = 0;
    const cardWidth = cards[0].offsetWidth; // includes padding if set correctly
    
    // Adjust based on screen size how many cards show
    const getVisibleCards = () => window.innerWidth < 768 ? 1 : 3;
    
    const updateSlider = () => {
      const translateX = -(currentIndex * cardWidth);
      track.style.transform = `translateX(${translateX}px)`;
    };

    nextBtn.addEventListener('click', () => {
      if (currentIndex < cards.length - getVisibleCards()) {
        currentIndex++;
        updateSlider();
      } else {
        // Optional: Loop back to start
        currentIndex = 0; 
        updateSlider();
      }
    });

    prevBtn.addEventListener('click', () => {
      if (currentIndex > 0) {
        currentIndex--;
        updateSlider();
      }
    });
  }
});
</script>

{% endblock %}